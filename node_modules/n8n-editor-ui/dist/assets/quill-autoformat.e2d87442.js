import{q as G}from"./quill.470e9400.js";import{b as Q}from"./axios.4a974fe3.js";var I={exports:{}};(function(K,z){(function(_,m){K.exports=m(G.exports)})(window,function(_){return function(m){var h={};function a(o){if(h[o])return h[o].exports;var n=h[o]={i:o,l:!1,exports:{}};return m[o].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=m,a.c=h,a.d=function(o,n,d){a.o(o,n)||Object.defineProperty(o,n,{enumerable:!0,get:d})},a.r=function(o){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},a.t=function(o,n){if(1&n&&(o=a(o)),8&n||4&n&&typeof o=="object"&&o&&o.__esModule)return o;var d=Object.create(null);if(a.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:o}),2&n&&typeof o!="string")for(var v in o)a.d(d,v,function(E){return o[E]}.bind(null,v));return d},a.n=function(o){var n=o&&o.__esModule?function(){return o.default}:function(){return o};return a.d(n,"a",n),n},a.o=function(o,n){return Object.prototype.hasOwnProperty.call(o,n)},a.p="",a(a.s=1)}([function(m,h){m.exports=_},function(m,h,a){a.r(h);var o=a(0),n=a.n(o);const d=n.a.import("blots/embed"),v=n.a.import("blots/inline"),E=n.a.import("blots/text"),O=n.a.import("blots/cursor");class b extends d{static create(t){let e=super.create(t);return e.setAttribute("href",this.BASE_URL+t),e.setAttribute("spellcheck",!1),e.textContent="#"+t,e}static formats(t){return t.getAttribute("href").substr(this.BASE_URL.length)}format(t,e){this.domNode.setAttribute("href",this.BASE_URL+e)}static value(t){return t.textContent.substr(1)}}b.blotName="hashtag",b.className="ql-hashtag",b.tagName="A",b.BASE_URL="#";class x extends v{static create(t){let e=super.create(t);return e.setAttribute("href",this.BASE_URL+t),e.setAttribute("spellcheck",!1),e}static formats(t){return t.getAttribute("href").substr(this.BASE_URL.length)}format(t,e){this.domNode.setAttribute("href",this.BASE_URL+e)}}x.blotName="hashtag",x.className="ql-hashtag",x.tagName="A",x.allowedChildren=[E,O],x.BASE_URL="#";const P=n.a.import("blots/embed");class w extends P{static create(t){const e=super.create(t);return e.setAttribute("title",t),e.setAttribute("href",this.BASE_URL+t),e.textContent="@"+t,e}static value(t){return t.textContent.substr(1)}}w.blotName="mention",w.className="ql-mention",w.tagName="A",w.BASE_URL="/";var k=w;function D(s,t){return function(e){if(Array.isArray(e))return e}(s)||function(e,i){var r=[],c=!0,p=!1,l=void 0;try{for(var u,f=e[Symbol.iterator]();!(c=(u=f.next()).done)&&(r.push(u.value),!i||r.length!==i);c=!0);}catch(y){p=!0,l=y}finally{try{c||f.return==null||f.return()}finally{if(p)throw l}}return r}(s,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}const M=n.a.import("core/module"),q=n.a.import("delta"),N=n.a.import("parchment"),F=N.Attributor,X=N.Scope;class S extends M{constructor(t,e){super(t,e),this.transforms=e,this.registerTypeListener(),this.registerPasteListener()}registerPasteListener(){for(const t in this.transforms){const e=this.transforms[t];this.quill.clipboard.addMatcher(Node.TEXT_NODE,(i,r)=>{if(typeof i.data=="string")return r.ops.forEach((c,p,l)=>{if(typeof c.insert=="string"){let u=U(e,c.insert),f=new q([c]).compose(u);l.splice(p,1,...f.ops)}}),r})}}registerTypeListener(){this.quill.keyboard.addBinding({key:38,collapsed:!0,format:["autoformat-helper"]},this.forwardKeyboardUp.bind(this)),this.quill.keyboard.addBinding({key:40,collapsed:!0,format:["autoformat-helper"]},this.forwardKeyboardDown.bind(this)),this.quill.on(n.a.events.TEXT_CHANGE,(t,e,i)=>{let r=t.ops;if(i!=="user"||!r||r.length<1)return;let c=r.length-1,p=r[c];for(;!p.insert&&c>0;)p=r[--c];if(!p.insert||typeof p.insert!="string")return;let l=p.insert===`
`,u=this.quill.getSelection();if(!u)return;let f=this.quill.getLength()-u.index-(l?1:0),y=u.index,A=D(this.quill.getLeaf(y),1)[0];if(!A||!A.text)return;let R=A.offset(A.scroll),$=y-R,T=!1;for(const C in this.transforms){const g=this.transforms[C];if(g.helper&&g.helper.trigger&&p.insert.match(g.helper.trigger))this.quill.formatText(y,1,"autoformat-helper",C,n.a.sources.API),this.openHelper(g,y);else if(p.insert.match(g.trigger||/./)){this.closeHelper(g);let L=new q().retain(R),j=U(g,A.text,$);j&&(L=L.concat(j)),this.quill.updateContents(L,"api"),T=!0}}T&&setTimeout(()=>{this.quill.setSelection(this.quill.getLength()-f,"api")},0)})}forwardKeyboard(t,e){if(this.currentHelper&&this.currentHelper.container){let i=this.currentHelper.container.querySelector(".dropdown-menu");console.log("keyboard",i,e.event),i.dispatchEvent(e.event)}}forwardKeyboardUp(t,e){var i=new KeyboardEvent("keydown",{key:"ArrowUp",keyCode:38,which:38,bubbles:!0,cancelable:!0});e.event=i,this.forwardKeyboard(t,e)}forwardKeyboardDown(t,e){var i=new KeyboardEvent("keydown",{key:"ArrowDown",keyCode:40,which:40,bubbles:!0,cancelable:!0});e.event=i,this.forwardKeyboard(t,e)}openHelper(t,e){if(t.helper&&(this.currentHelper=t.helper,typeof t.helper.open=="function")){console.log("openHelper",e,this.quill.getFormat(e));let i=this.quill.getBounds(e),r=this.quill.addContainer("ql-helper");r.style.position="absolute",r.style.top=i.top+"px",r.style.left=i.left+"px",r.style.width=i.width+"px",r.style.height=i.height+"px",console.log("openHelper",i,r),t.helper.container=r,t.helper.open(r)}}closeHelper(t){t.helper&&typeof t.helper.close=="function"&&t.helper.close(t.helper.container)}}function U(s,t,e){s.find.global||(s.find=new RegExp(s.find,s.find.flags+"g")),s.find.lastIndex=0;let i=new q,r=null;if(e!=null)for(r=s.find.exec(t);r&&r.length&&r.index<e;){if(r.index<e&&r.index+r[0].length+1>=e){i=i.concat(B(s,r).ops);break}r=s.find.exec(t)}else for(;(r=s.find.exec(t))!==null;){let c=B(s,r);i=i.concat(c.ops),t=t.substr(c.rightIndex),s.find.lastIndex=0}return i}function B(s,t){let e=(t=function(l,u){if(l.extract){let f=new RegExp(l.extract).exec(u[0]);return f&&f.length?(f.index+=u.index,f):u}return u}(s,t)).index,i=function(l,u){let f=new RegExp(l.extract||l.find);return l.transform?u.replace(f,l.transform):u}(s,t[0]),r=i;s.insert&&((r={})[s.insert]=i);let c=function(l,u){let f={};return typeof l.format=="string"?f[l.format]=u:typeof l.format=="object"&&(f=l.format),f}(s,i);const p=new q;return p.retain(e).delete(t[0].length).insert(r,c),{ops:p,rightIndex:e+t[0].length}}S.DEFAULTS={hashtag:{trigger:/[\s.,;:!?]/,find:/(?:^|\s)#[^\s.,;:!?]+/i,extract:/#([^\s.,;:!?]+)/i,transform:"$1",insert:"hashtag"},mention:{trigger:/[\s.,;:!?]/,find:/(?:^|\s)@[^\s.,;:!?]+/i,extract:/@([^\s.,;:!?]+)/i,transform:"$1",insert:"mention"},link:{trigger:/[\s]/,find:/https?:\/\/[\S]+|(www\.[\S]+)/gi,transform:function(s,t){return t?"http://"+s:s},format:"link"}};const H=new F("autoformat-helper","data-helper",{scope:X.INLINE});a.d(h,"default",function(){return S}),a.d(h,"Hashtag",function(){return b}),a.d(h,"Mention",function(){return k}),a.d(h,"AutoformatHelperAttribute",function(){return H}),n.a.version&&parseInt(n.a.version[0])<2&&console.warn("quill-autoformat requires Quill 2.0 or higher to work properly"),n.a.register({"modules/autoformat":S,"formats/hashtag":b,"formats/mention":k,"formats/autoformat-helper":H})}])})})(I);var W=Q(I.exports);export{W as A};
